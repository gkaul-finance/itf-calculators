<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 9: WACC & Firm Valuation | Introduction to Finance</title>
    <style>
        :root { --primary: #00274C; --secondary: #FFCB05; --accent: #2196F3; --success: #4CAF50; --warning: #FF9800; --danger: #f44336; --light: #f8f9fa; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; padding: 20px; line-height: 1.6; }
        .container { max-width: 1000px; margin: 0 auto; }
        header { background: var(--primary); color: white; padding: 2rem; border-radius: 12px 12px 0 0; text-align: center; }
        header h1 { font-size: 1.8rem; margin-bottom: 0.5rem; }
        .chapter-badge { background: var(--secondary); color: var(--primary); padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; display: inline-block; margin-bottom: 1rem; }
        .main-content { background: white; padding: 2rem; border-radius: 0 0 12px 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .tabs { display: flex; gap: 10px; margin-bottom: 2rem; flex-wrap: wrap; }
        .tab-btn { padding: 12px 20px; border: 2px solid var(--primary); background: white; color: var(--primary); border-radius: 8px; cursor: pointer; font-size: 0.95rem; font-weight: 500; }
        .tab-btn:hover { background: var(--light); }
        .tab-btn.active { background: var(--primary); color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .calculator-section { background: var(--light); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; }
        .calculator-section h3 { color: var(--primary); margin-bottom: 1rem; }
        .input-group { margin-bottom: 1rem; }
        .input-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        .input-group input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; }
        .input-group input:focus { outline: none; border-color: var(--accent); }
        .input-group input[readonly] { background: #e9ecef; }
        .input-group small { color: #666; font-size: 0.85rem; }
        .input-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; }
        .result-box { background: linear-gradient(135deg, var(--primary) 0%, #003366 100%); color: white; padding: 2rem; border-radius: 12px; text-align: center; margin: 1.5rem 0; }
        .result-label { font-size: 1rem; opacity: 0.9; margin-bottom: 0.5rem; }
        .result-value { font-size: 2.5rem; font-weight: 700; }
        .result-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .result-item { background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px; }
        .result-item-label { font-size: 0.8rem; opacity: 0.8; }
        .result-item-value { font-size: 1.1rem; font-weight: 600; }
        .formula-box { background: #e3f2fd; border-left: 4px solid var(--accent); padding: 1rem 1.5rem; margin: 1rem 0; border-radius: 0 8px 8px 0; }
        .insight-box { background: #fff3e0; border-left: 4px solid var(--warning); padding: 1rem 1.5rem; margin: 1rem 0; border-radius: 0 8px 8px 0; }
        .insight-box h4 { color: var(--warning); margin-bottom: 0.5rem; }
        .principle-box { background: #e8f5e9; border-left: 4px solid var(--success); padding: 1rem 1.5rem; margin: 1rem 0; border-radius: 0 8px 8px 0; }
        .principle-box h4 { color: var(--success); margin-bottom: 0.5rem; }
        .caveat-box { background: #fce4ec; border-left: 4px solid #e91e63; padding: 1rem 1.5rem; margin: 1rem 0; border-radius: 0 8px 8px 0; }
        .caveat-box h4 { color: #c2185b; margin-bottom: 0.5rem; }
        .waterfall { background: var(--light); padding: 1.5rem; border-radius: 8px; margin: 1rem 0; }
        .waterfall-row { display: flex; justify-content: space-between; padding: 0.6rem 0; border-bottom: 1px solid #ddd; }
        .waterfall-row:last-child { border-bottom: none; }
        .waterfall-row.total { font-weight: bold; background: var(--primary); color: white; margin: 0.5rem -1.5rem -1.5rem; padding: 1rem 1.5rem; border-radius: 0 0 8px 8px; }
        .leverage-demo { background: #f5f5f5; padding: 1.5rem; border-radius: 8px; margin: 1.5rem 0; }
        .leverage-demo h4 { color: var(--primary); margin-bottom: 1rem; }
        .demo-table { width: 100%; border-collapse: collapse; }
        .demo-table th, .demo-table td { padding: 10px; text-align: center; border: 1px solid #ddd; }
        .demo-table th { background: var(--primary); color: white; }
        .demo-table tr:nth-child(even) { background: #f9f9f9; }
        .highlight-same { background: #c8e6c9 !important; font-weight: bold; }
        footer { text-align: center; padding: 2rem; color: #666; }
        footer a { color: var(--primary); }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="chapter-badge">Chapter 9</div>
            <h1>WACC & Firm Valuation</h1>
            <p>Return on Assets, Capital Structure & Enterprise Value</p>
        </header>
        
        <div class="main-content">
            <div class="principle-box">
                <h4>üéØ Core Principle: Financing is Value-Neutral</h4>
                <p><strong>WACC = Return on Unlevered Equity = Return on Assets</strong></p>
                <p>The real assets of a firm determine its required return. How you finance those assets (debt vs. equity) does not change what the assets must earn. You cannot create value by slicing the pie differently.</p>
            </div>
            
            <div class="tabs">
                <button class="tab-btn active" onclick="showTab('wacc')">WACC = R<sub>A</sub></button>
                <button class="tab-btn" onclick="showTab('invariance')">Leverage Invariance</button>
                <button class="tab-btn" onclick="showTab('valuation')">Firm Valuation</button>
                <button class="tab-btn" onclick="showTab('equity')">Equity Value</button>
            </div>
            
            <!-- WACC = Return on Assets -->
            <div id="wacc" class="tab-content active">
                <div class="calculator-section">
                    <h3>Return on Assets (WACC)</h3>
                    <p>The required return is determined by the <strong>assets</strong>, not by how they're financed.</p>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label>Return on Assets / WACC (%)</label>
                            <input type="number" id="wacc-ra" value="10" step="0.1" oninput="calculateWACC()">
                            <small>Determined by asset risk (business risk)</small>
                        </div>
                        <div class="input-group">
                            <label>Cost of Debt R<sub>d</sub> (%)</label>
                            <input type="number" id="wacc-rd" value="5" step="0.1" oninput="calculateWACC()">
                            <small>Rate paid to lenders</small>
                        </div>
                    </div>
                    <div class="input-row">
                        <div class="input-group">
                            <label>Market Value of Equity ($M)</label>
                            <input type="number" id="wacc-mve" value="600" oninput="calculateWACC()">
                        </div>
                        <div class="input-group">
                            <label>Market Value of Debt ($M)</label>
                            <input type="number" id="wacc-mvd" value="400" oninput="calculateWACC()">
                        </div>
                    </div>
                </div>
                
                <div class="result-box">
                    <div class="result-label">Required Return on Equity (R<sub>E</sub>)</div>
                    <div class="result-value" id="wacc-re-result">13.33%</div>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="result-item-label">Return on Assets</div>
                            <div class="result-item-value" id="wacc-ra-display">10.00%</div>
                        </div>
                        <div class="result-item">
                            <div class="result-item-label">Cost of Debt</div>
                            <div class="result-item-value" id="wacc-rd-display">5.00%</div>
                        </div>
                        <div class="result-item">
                            <div class="result-item-label">D/E Ratio</div>
                            <div class="result-item-value" id="wacc-de">0.67</div>
                        </div>
                        <div class="result-item">
                            <div class="result-item-label">WACC Check</div>
                            <div class="result-item-value" id="wacc-check">10.00%</div>
                        </div>
                    </div>
                </div>
                
                <div class="waterfall">
                    <h4 style="color: var(--primary); margin-bottom: 1rem;">WACC Composition (always equals R<sub>A</sub>)</h4>
                    <div class="waterfall-row">
                        <span>Equity Component: W<sub>E</sub> √ó R<sub>E</sub></span>
                        <span id="wacc-eq-comp">60% √ó 13.33% = 8.00%</span>
                    </div>
                    <div class="waterfall-row">
                        <span>Debt Component: W<sub>D</sub> √ó R<sub>D</sub></span>
                        <span id="wacc-debt-comp">40% √ó 5.00% = 2.00%</span>
                    </div>
                    <div class="waterfall-row total">
                        <span>WACC = Return on Assets</span>
                        <span id="wacc-total">10.00%</span>
                    </div>
                </div>
                
                <div class="formula-box">
                    <strong>Key Relationships:</strong><br><br>
                    <code>WACC = R<sub>A</sub> = (E/V) √ó R<sub>E</sub> + (D/V) √ó R<sub>D</sub></code><br><br>
                    <code>R<sub>E</sub> = R<sub>A</sub> + (D/E) √ó (R<sub>A</sub> - R<sub>D</sub>)</code><br><br>
                    <small>Equity holders bear more risk with leverage, so R<sub>E</sub> increases. But this exactly offsets the "cheaper" debt, leaving WACC unchanged.</small>
                </div>
                
                <div class="insight-box">
                    <h4>üí° Why Does R<sub>E</sub> Increase with Leverage?</h4>
                    <p id="wacc-insight">With a D/E ratio of 0.67, equity holders take on more risk. They require 13.33% ‚Äî higher than the 10% asset return. But when you weight it all together: 60% √ó 13.33% + 40% √ó 5% = 10%. <strong>WACC always equals R<sub>A</sub>!</strong></p>
                </div>
            </div>
            
            <!-- Leverage Invariance Demo -->
            <div id="invariance" class="tab-content">
                <div class="calculator-section">
                    <h3>Leverage Doesn't Change WACC</h3>
                    <p>Watch what happens as we change the capital structure ‚Äî WACC stays the same!</p>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label>Return on Assets R<sub>A</sub> (%)</label>
                            <input type="number" id="demo-ra" value="10" step="0.5" oninput="calculateDemo()">
                            <small>This is fixed by the assets</small>
                        </div>
                        <div class="input-group">
                            <label>Cost of Debt R<sub>D</sub> (%)</label>
                            <input type="number" id="demo-rd" value="5" step="0.5" oninput="calculateDemo()">
                        </div>
                        <div class="input-group">
                            <label>Total Firm Value ($M)</label>
                            <input type="number" id="demo-v" value="1000" oninput="calculateDemo()">
                        </div>
                    </div>
                </div>
                
                <div class="leverage-demo">
                    <h4>Capital Structure Scenarios</h4>
                    <table class="demo-table" id="demo-table">
                        <thead>
                            <tr>
                                <th>D/E Ratio</th>
                                <th>Debt ($M)</th>
                                <th>Equity ($M)</th>
                                <th>R<sub>E</sub></th>
                                <th>R<sub>D</sub></th>
                                <th>WACC</th>
                            </tr>
                        </thead>
                        <tbody>
                            <!-- Generated dynamically -->
                        </tbody>
                    </table>
                </div>
                
                <div class="result-box">
                    <div class="result-label">WACC Across All Capital Structures</div>
                    <div class="result-value" id="demo-wacc">10.00%</div>
                    <p style="margin-top: 1rem; opacity: 0.9;">Always equals Return on Assets ‚Äî financing is irrelevant!</p>
                </div>
                
                <div class="principle-box">
                    <h4>üéØ The M-M Insight</h4>
                    <p><strong>The pie doesn't get bigger by slicing it differently.</strong></p>
                    <p>Whether you have 0% debt or 80% debt, the total value of the firm is the same. More debt makes equity riskier (higher R<sub>E</sub>), but this exactly offsets the lower cost of debt. Value comes from assets, not financing.</p>
                </div>
            </div>
            
            <!-- Firm Valuation -->
            <div id="valuation" class="tab-content">
                <div class="calculator-section">
                    <h3>DCF Firm Valuation</h3>
                    <p>Value the firm using Free Cash Flow to Firm, discounted at WACC (= R<sub>A</sub>)</p>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label>Next Year's FCF ($M)</label>
                            <input type="number" id="val-fcf" value="50" oninput="calculateValuation()">
                            <small>Free Cash Flow to Firm</small>
                        </div>
                        <div class="input-group">
                            <label>WACC / R<sub>A</sub> (%)</label>
                            <input type="number" id="val-wacc" value="10" step="0.1" oninput="calculateValuation()">
                        </div>
                        <div class="input-group">
                            <label>Growth Rate (%)</label>
                            <input type="number" id="val-g" value="3" step="0.5" oninput="calculateValuation()">
                            <small>Sustainable long-term growth</small>
                        </div>
                    </div>
                </div>
                
                <div class="result-box">
                    <div class="result-label">Enterprise Value</div>
                    <div class="result-value" id="val-ev">$714.29M</div>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="result-item-label">FCF Yield</div>
                            <div class="result-item-value" id="val-ratio">7.00%</div>
                        </div>
                        <div class="result-item">
                            <div class="result-item-label">EV / FCF Multiple</div>
                            <div class="result-item-value" id="val-multiple">14.3x</div>
                        </div>
                    </div>
                </div>
                
                <div class="formula-box">
                    <strong>Enterprise Value (Growing Perpetuity):</strong><br>
                    <code>EV = FCF<sub>1</sub> / (WACC - g) = FCF<sub>1</sub> / (R<sub>A</sub> - g)</code><br><br>
                    <small>This is the Gordon Growth model applied to the whole firm. Note: EV doesn't change with capital structure because WACC = R<sub>A</sub> is constant!</small>
                </div>
                
                <div class="insight-box">
                    <h4>üí° Value Comes From Assets</h4>
                    <p id="val-insight">Enterprise value of $714M depends only on the cash flows from the assets and the risk of those assets (R<sub>A</sub> = 10%). How you finance doesn't change EV!</p>
                </div>
            </div>
            
            <!-- Equity Value -->
            <div id="equity" class="tab-content">
                <div class="calculator-section">
                    <h3>From Enterprise Value to Equity Value</h3>
                    <p>EV is constant, but equity value changes with capital structure</p>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label>Enterprise Value ($M)</label>
                            <input type="number" id="eq-ev" value="714" oninput="calculateEquity()">
                        </div>
                        <div class="input-group">
                            <label>Total Debt ($M)</label>
                            <input type="number" id="eq-debt" value="200" oninput="calculateEquity()">
                        </div>
                    </div>
                    <div class="input-row">
                        <div class="input-group">
                            <label>Cash & Equivalents ($M)</label>
                            <input type="number" id="eq-cash" value="50" oninput="calculateEquity()">
                        </div>
                        <div class="input-group">
                            <label>Shares Outstanding (M)</label>
                            <input type="number" id="eq-shares" value="40" oninput="calculateEquity()">
                        </div>
                    </div>
                </div>
                
                <div class="result-box">
                    <div class="result-label">Equity Value</div>
                    <div class="result-value" id="eq-result">$564.00M</div>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="result-item-label">Price per Share</div>
                            <div class="result-item-value" id="eq-price">$14.10</div>
                        </div>
                        <div class="result-item">
                            <div class="result-item-label">Net Debt</div>
                            <div class="result-item-value" id="eq-netdebt">$150.00M</div>
                        </div>
                    </div>
                </div>
                
                <div class="waterfall">
                    <h4 style="color: var(--primary); margin-bottom: 1rem;">Bridge from EV to Equity</h4>
                    <div class="waterfall-row">
                        <span>Enterprise Value</span>
                        <span id="eq-ev-display">$714.00M</span>
                    </div>
                    <div class="waterfall-row">
                        <span>‚àí Total Debt</span>
                        <span id="eq-debt-display">($200.00M)</span>
                    </div>
                    <div class="waterfall-row">
                        <span>+ Cash & Equivalents</span>
                        <span id="eq-cash-display">$50.00M</span>
                    </div>
                    <div class="waterfall-row total">
                        <span>= Equity Value</span>
                        <span id="eq-total-display">$564.00M</span>
                    </div>
                </div>
                
                <div class="formula-box">
                    <strong>Key Relationship:</strong><br>
                    <code>Equity Value = EV - Debt + Cash</code><br><br>
                    <small>EV stays constant (determined by assets). More debt ‚Üí Less equity value, but remaining equity is riskier and has higher required return.</small>
                </div>
            </div>
            
            <!-- Real World Caveat -->
            <div class="caveat-box">
                <h4>‚ö†Ô∏è A Note on Real-World Tax Treatment</h4>
                <p>In the real world, interest payments on debt are tax-deductible. One common way to account for this is to use <strong>R<sub>D</sub> √ó (1 - T)</strong> in the WACC formula instead of R<sub>D</sub>.</p>
                <p style="margin-top: 0.5rem;">However, this adjustment is more complicated than it appears. It raises difficult questions: What is the correct discount rate for the tax shield? How do you unlever and relever betas consistently? These issues are beyond the scope of this course.</p>
                <p style="margin-top: 0.5rem;"><strong>For this course:</strong> We allow for taxes on corporate income, but not for the deductibility of interest from taxes. This keeps our framework clean and emphasizes the core insight: <em>real assets determine value, financing is just rearranging claims.</em></p>
            </div>
        </div>
        
        <footer>
            <p><strong>Introduction to Finance</strong> | Professor Gautam Kaul | University of Michigan Ross School of Business</p>
            <p><a href="index.html">‚Üê Back to All Calculators</a></p>
        </footer>
    </div>
    
    <script>
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }
        
        function formatPercent(value) { return value.toFixed(2) + '%'; }
        function formatMoney(value) { return '$' + value.toFixed(2) + 'M'; }
        
        function calculateWACC() {
            const ra = parseFloat(document.getElementById('wacc-ra').value) / 100 || 0.10;
            const rd = parseFloat(document.getElementById('wacc-rd').value) / 100 || 0.05;
            const mve = parseFloat(document.getElementById('wacc-mve').value) || 600;
            const mvd = parseFloat(document.getElementById('wacc-mvd').value) || 400;
            
            const totalValue = mve + mvd;
            const we = mve / totalValue;
            const wd = mvd / totalValue;
            const de = mvd / mve;
            
            // RE = RA + (D/E) √ó (RA - RD)
            const re = ra + de * (ra - rd);
            
            // WACC should equal RA
            const wacc = we * re + wd * rd;
            
            document.getElementById('wacc-re-result').textContent = formatPercent(re * 100);
            document.getElementById('wacc-ra-display').textContent = formatPercent(ra * 100);
            document.getElementById('wacc-rd-display').textContent = formatPercent(rd * 100);
            document.getElementById('wacc-de').textContent = de.toFixed(2);
            document.getElementById('wacc-check').textContent = formatPercent(wacc * 100);
            
            document.getElementById('wacc-eq-comp').textContent = `${(we*100).toFixed(0)}% √ó ${formatPercent(re*100)} = ${formatPercent(we * re * 100)}`;
            document.getElementById('wacc-debt-comp').textContent = `${(wd*100).toFixed(0)}% √ó ${formatPercent(rd*100)} = ${formatPercent(wd * rd * 100)}`;
            document.getElementById('wacc-total').textContent = formatPercent(wacc * 100);
            
            document.getElementById('wacc-insight').textContent = 
                `With a D/E ratio of ${de.toFixed(2)}, equity holders take on more risk. They require ${formatPercent(re*100)} ‚Äî higher than the ${formatPercent(ra*100)} asset return. But when you weight it all together: ${(we*100).toFixed(0)}% √ó ${formatPercent(re*100)} + ${(wd*100).toFixed(0)}% √ó ${formatPercent(rd*100)} = ${formatPercent(wacc*100)}. WACC always equals RA!`;
        }
        
        function calculateDemo() {
            const ra = parseFloat(document.getElementById('demo-ra').value) / 100 || 0.10;
            const rd = parseFloat(document.getElementById('demo-rd').value) / 100 || 0.05;
            const v = parseFloat(document.getElementById('demo-v').value) || 1000;
            
            const scenarios = [
                { de: 0, label: '0%' },
                { de: 0.25, label: '25%' },
                { de: 0.5, label: '50%' },
                { de: 1.0, label: '100%' },
                { de: 2.0, label: '200%' }
            ];
            
            const tbody = document.querySelector('#demo-table tbody');
            tbody.innerHTML = '';
            
            scenarios.forEach(s => {
                const d = v * s.de / (1 + s.de);
                const e = v - d;
                const re = ra + s.de * (ra - rd);
                const we = e / v;
                const wd = d / v;
                const wacc = we * re + wd * rd;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${s.label}</td>
                    <td>$${d.toFixed(0)}</td>
                    <td>$${e.toFixed(0)}</td>
                    <td>${formatPercent(re * 100)}</td>
                    <td>${formatPercent(rd * 100)}</td>
                    <td class="highlight-same">${formatPercent(wacc * 100)}</td>
                `;
                tbody.appendChild(row);
            });
            
            document.getElementById('demo-wacc').textContent = formatPercent(ra * 100);
        }
        
        function calculateValuation() {
            const fcf = parseFloat(document.getElementById('val-fcf').value) || 0;
            const wacc = parseFloat(document.getElementById('val-wacc').value) / 100 || 0.10;
            const g = parseFloat(document.getElementById('val-g').value) / 100 || 0;
            
            if (wacc <= g) {
                document.getElementById('val-ev').textContent = 'WACC must > g';
                return;
            }
            
            const ev = fcf / (wacc - g);
            const ratio = fcf / ev * 100;
            const multiple = ev / fcf;
            
            document.getElementById('val-ev').textContent = formatMoney(ev);
            document.getElementById('val-ratio').textContent = formatPercent(ratio);
            document.getElementById('val-multiple').textContent = multiple.toFixed(1) + 'x';
            
            document.getElementById('val-insight').textContent = 
                `Enterprise value of ${formatMoney(ev)} depends only on the cash flows from the assets and the risk of those assets (RA = ${formatPercent(wacc*100)}). How you finance doesn't change EV!`;
        }
        
        function calculateEquity() {
            const ev = parseFloat(document.getElementById('eq-ev').value) || 0;
            const debt = parseFloat(document.getElementById('eq-debt').value) || 0;
            const cash = parseFloat(document.getElementById('eq-cash').value) || 0;
            const shares = parseFloat(document.getElementById('eq-shares').value) || 1;
            
            const equityValue = ev - debt + cash;
            const pricePerShare = equityValue / shares;
            const netDebt = debt - cash;
            
            document.getElementById('eq-result').textContent = formatMoney(equityValue);
            document.getElementById('eq-price').textContent = '$' + pricePerShare.toFixed(2);
            document.getElementById('eq-netdebt').textContent = formatMoney(netDebt);
            
            document.getElementById('eq-ev-display').textContent = formatMoney(ev);
            document.getElementById('eq-debt-display').textContent = '(' + formatMoney(debt) + ')';
            document.getElementById('eq-cash-display').textContent = formatMoney(cash);
            document.getElementById('eq-total-display').textContent = formatMoney(equityValue);
        }
        
        // Initialize
        calculateWACC();
        calculateDemo();
        calculateValuation();
        calculateEquity();
    </script>
</body>
</html>
