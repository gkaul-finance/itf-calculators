<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 8: CAPM Calculator | Introduction to Finance</title>
    <style>
        :root { --primary: #00274C; --secondary: #FFCB05; --accent: #2196F3; --success: #4CAF50; --warning: #FF9800; --danger: #f44336; --light: #f8f9fa; }
        * { box-sizing: border-box; margin: 0; padding: 0; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; padding: 20px; line-height: 1.6; }
        .container { max-width: 950px; margin: 0 auto; }
        header { background: var(--primary); color: white; padding: 2rem; border-radius: 12px 12px 0 0; text-align: center; }
        header h1 { font-size: 1.8rem; margin-bottom: 0.5rem; }
        .chapter-badge { background: var(--secondary); color: var(--primary); padding: 4px 12px; border-radius: 20px; font-size: 0.85rem; font-weight: 600; display: inline-block; margin-bottom: 1rem; }
        .main-content { background: white; padding: 2rem; border-radius: 0 0 12px 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .tabs { display: flex; gap: 10px; margin-bottom: 2rem; flex-wrap: wrap; }
        .tab-btn { padding: 12px 20px; border: 2px solid var(--primary); background: white; color: var(--primary); border-radius: 8px; cursor: pointer; font-size: 0.95rem; font-weight: 500; }
        .tab-btn:hover { background: var(--light); }
        .tab-btn.active { background: var(--primary); color: white; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
        .calculator-section { background: var(--light); padding: 1.5rem; border-radius: 8px; margin-bottom: 1.5rem; }
        .calculator-section h3 { color: var(--primary); margin-bottom: 1rem; }
        .input-group { margin-bottom: 1rem; }
        .input-group label { display: block; margin-bottom: 0.5rem; font-weight: 500; }
        .input-group input { width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; font-size: 1rem; }
        .input-group input:focus { outline: none; border-color: var(--accent); }
        .input-group small { color: #666; font-size: 0.85rem; }
        .input-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 1rem; }
        .result-box { background: linear-gradient(135deg, var(--primary) 0%, #003366 100%); color: white; padding: 2rem; border-radius: 12px; text-align: center; margin: 1.5rem 0; }
        .result-label { font-size: 1rem; opacity: 0.9; margin-bottom: 0.5rem; }
        .result-value { font-size: 2.5rem; font-weight: 700; }
        .result-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(130px, 1fr)); gap: 1rem; margin-top: 1rem; }
        .result-item { background: rgba(255,255,255,0.1); padding: 1rem; border-radius: 8px; }
        .result-item-label { font-size: 0.8rem; opacity: 0.8; }
        .result-item-value { font-size: 1.1rem; font-weight: 600; }
        .formula-box { background: #e3f2fd; border-left: 4px solid var(--accent); padding: 1rem 1.5rem; margin: 1rem 0; border-radius: 0 8px 8px 0; }
        .insight-box { background: #fff3e0; border-left: 4px solid var(--warning); padding: 1rem 1.5rem; margin: 1rem 0; border-radius: 0 8px 8px 0; }
        .insight-box h4 { color: var(--warning); margin-bottom: 0.5rem; }
        .sml-visual { background: #f5f5f5; padding: 1.5rem; border-radius: 8px; margin: 1rem 0; text-align: center; }
        .beta-scale { display: flex; justify-content: space-between; align-items: center; padding: 1rem; background: linear-gradient(to right, var(--success), var(--secondary), var(--danger)); border-radius: 8px; color: white; font-weight: bold; margin: 1rem 0; }
        footer { text-align: center; padding: 2rem; color: #666; }
        footer a { color: var(--primary); }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="chapter-badge">Chapter 8</div>
            <h1>CAPM Calculator</h1>
            <p>Capital Asset Pricing Model & Required Returns</p>
        </header>
        
        <div class="main-content">
            <div class="tabs">
                <button class="tab-btn active" onclick="showTab('capm')">Required Return</button>
                <button class="tab-btn" onclick="showTab('beta')">Calculate Beta</button>
                <button class="tab-btn" onclick="showTab('sml')">Security Market Line</button>
            </div>
            
            <!-- CAPM Required Return -->
            <div id="capm" class="tab-content active">
                <div class="calculator-section">
                    <h3>CAPM: Calculate Required Return</h3>
                    <p>What return should you require given the stock's risk?</p>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label>Risk-Free Rate (Rf) %</label>
                            <input type="number" id="capm-rf" value="4" step="0.1" oninput="calculateCAPM()">
                            <small>Treasury bill/bond rate</small>
                        </div>
                        <div class="input-group">
                            <label>Market Return E(Rm) %</label>
                            <input type="number" id="capm-rm" value="10" step="0.1" oninput="calculateCAPM()">
                            <small>Expected market return</small>
                        </div>
                        <div class="input-group">
                            <label>Beta (Œ≤)</label>
                            <input type="number" id="capm-beta" value="1.2" step="0.1" oninput="calculateCAPM()">
                            <small>Stock's systematic risk</small>
                        </div>
                    </div>
                </div>
                
                <div class="result-box">
                    <div class="result-label">Required Return E(Ri)</div>
                    <div class="result-value" id="capm-result">11.20%</div>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="result-item-label">Risk-Free Component</div>
                            <div class="result-item-value" id="capm-rf-comp">4.00%</div>
                        </div>
                        <div class="result-item">
                            <div class="result-item-label">Market Risk Premium</div>
                            <div class="result-item-value" id="capm-mrp">6.00%</div>
                        </div>
                        <div class="result-item">
                            <div class="result-item-label">Risk Premium</div>
                            <div class="result-item-value" id="capm-rp">7.20%</div>
                        </div>
                    </div>
                </div>
                
                <div class="beta-scale">
                    <span>Œ≤ &lt; 1<br>Less Risky</span>
                    <span>Œ≤ = 1<br>Market Risk</span>
                    <span>Œ≤ &gt; 1<br>More Risky</span>
                </div>
                
                <div class="formula-box">
                    <strong>CAPM Formula:</strong><br>
                    <code>E(Ri) = Rf + Œ≤i √ó [E(Rm) - Rf]</code><br><br>
                    <small>Required Return = Risk-Free Rate + Beta √ó Market Risk Premium</small>
                </div>
                
                <div class="insight-box">
                    <h4>üí° Interpreting the Result</h4>
                    <p id="capm-insight">With Œ≤ = 1.2, this stock is 20% riskier than the market. Investors require 11.20% return ‚Äî that's 7.20% above the risk-free rate (1.2 √ó 6% market risk premium).</p>
                </div>
            </div>
            
            <!-- Calculate Beta -->
            <div id="beta" class="tab-content">
                <div class="calculator-section">
                    <h3>Calculate Beta from Returns</h3>
                    <p>Estimate beta using stock and market returns</p>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label>Covariance (Stock, Market)</label>
                            <input type="number" id="beta-cov" value="0.024" step="0.001" oninput="calculateBeta()">
                            <small>Cov(Ri, Rm)</small>
                        </div>
                        <div class="input-group">
                            <label>Market Variance</label>
                            <input type="number" id="beta-var" value="0.02" step="0.001" oninput="calculateBeta()">
                            <small>Var(Rm) = œÉm¬≤</small>
                        </div>
                    </div>
                    
                    <p style="margin-top: 1rem;"><strong>Or enter correlation and standard deviations:</strong></p>
                    <div class="input-row">
                        <div class="input-group">
                            <label>Correlation (œÅ)</label>
                            <input type="number" id="beta-corr" value="0.6" min="-1" max="1" step="0.1" oninput="calculateBetaFromCorr()">
                        </div>
                        <div class="input-group">
                            <label>Stock Std Dev (%)</label>
                            <input type="number" id="beta-sd-stock" value="25" step="1" oninput="calculateBetaFromCorr()">
                        </div>
                        <div class="input-group">
                            <label>Market Std Dev (%)</label>
                            <input type="number" id="beta-sd-mkt" value="15" step="1" oninput="calculateBetaFromCorr()">
                        </div>
                    </div>
                </div>
                
                <div class="result-box">
                    <div class="result-label">Beta (Œ≤)</div>
                    <div class="result-value" id="beta-result">1.20</div>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="result-item-label">Interpretation</div>
                            <div class="result-item-value" id="beta-interp">20% more volatile</div>
                        </div>
                        <div class="result-item">
                            <div class="result-item-label">If market ‚Üë 10%</div>
                            <div class="result-item-value" id="beta-up">Stock ‚Üë 12%</div>
                        </div>
                        <div class="result-item">
                            <div class="result-item-label">If market ‚Üì 10%</div>
                            <div class="result-item-value" id="beta-down">Stock ‚Üì 12%</div>
                        </div>
                    </div>
                </div>
                
                <div class="formula-box">
                    <strong>Beta Formulas:</strong><br>
                    <code>Œ≤ = Cov(Ri, Rm) / Var(Rm)</code><br>
                    <code>Œ≤ = œÅ √ó (œÉi / œÉm)</code>
                </div>
                
                <div class="insight-box">
                    <h4>üí° What Beta Measures</h4>
                    <p>Beta measures <strong>systematic risk</strong> ‚Äî the risk that cannot be diversified away. It shows how sensitive a stock is to market movements. Only systematic risk earns a risk premium!</p>
                </div>
            </div>
            
            <!-- Security Market Line -->
            <div id="sml" class="tab-content">
                <div class="calculator-section">
                    <h3>Security Market Line Analysis</h3>
                    <p>Is a stock fairly priced, undervalued, or overvalued?</p>
                    
                    <div class="input-row">
                        <div class="input-group">
                            <label>Risk-Free Rate (%)</label>
                            <input type="number" id="sml-rf" value="4" step="0.1" oninput="calculateSML()">
                        </div>
                        <div class="input-group">
                            <label>Market Return (%)</label>
                            <input type="number" id="sml-rm" value="10" step="0.1" oninput="calculateSML()">
                        </div>
                    </div>
                    <div class="input-row">
                        <div class="input-group">
                            <label>Stock's Beta</label>
                            <input type="number" id="sml-beta" value="1.3" step="0.1" oninput="calculateSML()">
                        </div>
                        <div class="input-group">
                            <label>Stock's Expected Return (%)</label>
                            <input type="number" id="sml-actual" value="14" step="0.1" oninput="calculateSML()">
                            <small>Your forecast / analyst estimate</small>
                        </div>
                    </div>
                </div>
                
                <div class="result-box" id="sml-result-box">
                    <div class="result-label">CAPM Required Return</div>
                    <div class="result-value" id="sml-required">11.80%</div>
                    <div class="result-grid">
                        <div class="result-item">
                            <div class="result-item-label">Expected Return</div>
                            <div class="result-item-value" id="sml-expected">14.00%</div>
                        </div>
                        <div class="result-item">
                            <div class="result-item-label">Alpha (Œ±)</div>
                            <div class="result-item-value" id="sml-alpha">+2.20%</div>
                        </div>
                        <div class="result-item">
                            <div class="result-item-label">Verdict</div>
                            <div class="result-item-value" id="sml-verdict">UNDERVALUED</div>
                        </div>
                    </div>
                </div>
                
                <div class="sml-visual">
                    <h4>Security Market Line Position</h4>
                    <div id="sml-position" style="font-size: 1.2rem; margin-top: 1rem; padding: 1rem; background: #e8f5e9; border-radius: 8px; color: #2e7d32;">
                        üìà Stock plots ABOVE the SML ‚Üí BUY signal (positive alpha)
                    </div>
                </div>
                
                <div class="insight-box">
                    <h4>üí° Investment Decision</h4>
                    <p id="sml-insight">The stock is expected to return 14%, but CAPM says you only need 11.8% for its risk level. The 2.2% excess return (alpha) suggests the stock is undervalued ‚Äî a potential buying opportunity!</p>
                </div>
            </div>
        </div>
        
        <footer>
            <p><strong>Introduction to Finance</strong> | Professor Gautam Kaul | University of Michigan Ross School of Business</p>
            <p><a href="index.html">‚Üê Back to All Calculators</a></p>
        </footer>
    </div>
    
    <script>
        function showTab(tabId) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
        }
        
        function formatPercent(value) { return value.toFixed(2) + '%'; }
        
        function calculateCAPM() {
            const rf = parseFloat(document.getElementById('capm-rf').value) || 0;
            const rm = parseFloat(document.getElementById('capm-rm').value) || 0;
            const beta = parseFloat(document.getElementById('capm-beta').value) || 0;
            
            const mrp = rm - rf;
            const riskPremium = beta * mrp;
            const required = rf + riskPremium;
            
            document.getElementById('capm-result').textContent = formatPercent(required);
            document.getElementById('capm-rf-comp').textContent = formatPercent(rf);
            document.getElementById('capm-mrp').textContent = formatPercent(mrp);
            document.getElementById('capm-rp').textContent = formatPercent(riskPremium);
            
            const riskDesc = beta > 1 ? `${((beta-1)*100).toFixed(0)}% riskier than` : beta < 1 ? `${((1-beta)*100).toFixed(0)}% less risky than` : 'as risky as';
            document.getElementById('capm-insight').textContent = 
                `With Œ≤ = ${beta.toFixed(1)}, this stock is ${riskDesc} the market. Investors require ${formatPercent(required)} return ‚Äî that's ${formatPercent(riskPremium)} above the risk-free rate (${beta.toFixed(1)} √ó ${formatPercent(mrp)} market risk premium).`;
        }
        
        function calculateBeta() {
            const cov = parseFloat(document.getElementById('beta-cov').value) || 0;
            const variance = parseFloat(document.getElementById('beta-var').value) || 0.01;
            const beta = cov / variance;
            updateBetaDisplay(beta);
        }
        
        function calculateBetaFromCorr() {
            const corr = parseFloat(document.getElementById('beta-corr').value) || 0;
            const sdStock = parseFloat(document.getElementById('beta-sd-stock').value) / 100 || 0;
            const sdMkt = parseFloat(document.getElementById('beta-sd-mkt').value) / 100 || 0.01;
            const beta = corr * (sdStock / sdMkt);
            updateBetaDisplay(beta);
        }
        
        function updateBetaDisplay(beta) {
            document.getElementById('beta-result').textContent = beta.toFixed(2);
            
            const interp = beta > 1 ? `${((beta-1)*100).toFixed(0)}% more volatile` : 
                          beta < 1 ? `${((1-beta)*100).toFixed(0)}% less volatile` : 'Same as market';
            document.getElementById('beta-interp').textContent = interp;
            document.getElementById('beta-up').textContent = `Stock ‚Üë ${(beta * 10).toFixed(1)}%`;
            document.getElementById('beta-down').textContent = `Stock ‚Üì ${(beta * 10).toFixed(1)}%`;
        }
        
        function calculateSML() {
            const rf = parseFloat(document.getElementById('sml-rf').value) || 0;
            const rm = parseFloat(document.getElementById('sml-rm').value) || 0;
            const beta = parseFloat(document.getElementById('sml-beta').value) || 0;
            const actual = parseFloat(document.getElementById('sml-actual').value) || 0;
            
            const required = rf + beta * (rm - rf);
            const alpha = actual - required;
            
            document.getElementById('sml-required').textContent = formatPercent(required);
            document.getElementById('sml-expected').textContent = formatPercent(actual);
            document.getElementById('sml-alpha').textContent = (alpha >= 0 ? '+' : '') + formatPercent(alpha);
            
            const resultBox = document.getElementById('sml-result-box');
            const position = document.getElementById('sml-position');
            
            if (alpha > 0.1) {
                document.getElementById('sml-verdict').textContent = 'UNDERVALUED';
                position.style.background = '#e8f5e9';
                position.style.color = '#2e7d32';
                position.innerHTML = 'üìà Stock plots ABOVE the SML ‚Üí BUY signal (positive alpha)';
            } else if (alpha < -0.1) {
                document.getElementById('sml-verdict').textContent = 'OVERVALUED';
                position.style.background = '#ffebee';
                position.style.color = '#c62828';
                position.innerHTML = 'üìâ Stock plots BELOW the SML ‚Üí SELL/AVOID signal (negative alpha)';
            } else {
                document.getElementById('sml-verdict').textContent = 'FAIRLY VALUED';
                position.style.background = '#fff3e0';
                position.style.color = '#e65100';
                position.innerHTML = '‚û°Ô∏è Stock plots ON the SML ‚Üí Fairly priced for its risk';
            }
            
            document.getElementById('sml-insight').textContent = 
                alpha > 0 
                    ? `The stock is expected to return ${formatPercent(actual)}, but CAPM says you only need ${formatPercent(required)} for its risk level. The ${formatPercent(alpha)} excess return (alpha) suggests the stock is undervalued ‚Äî a potential buying opportunity!`
                    : alpha < 0
                    ? `The stock is expected to return ${formatPercent(actual)}, but CAPM says you should require ${formatPercent(required)} for its risk level. The ${formatPercent(alpha)} shortfall suggests the stock is overvalued ‚Äî consider avoiding or selling.`
                    : `The stock's expected return matches what CAPM predicts for its beta. It's fairly priced for its risk level.`;
        }
        
        // Initialize
        calculateCAPM();
        calculateBeta();
        calculateSML();
    </script>
</body>
</html>
